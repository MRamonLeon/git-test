node() {
    dir('first') {
        def vars = checkout scm
        def url = sh(returnStdout: true, script: 'git config remote.origin.url').trim()
        echo "first, url is: ${url}"
        def branch = sh(returnStdout: true, script:'git rev-parse --abbrev-ref HEAD').trim()
        echo "first, branch is: ${branch}"

        dumpEnv('first', vars)
    }

    dir('second') {
        def vars = git url: 'git@github.com:MRamonLeon/git-test.git', branch: 'other'
        def url = sh(returnStdout: true, script: 'git config remote.origin.url').trim()
        echo "second url is: ${url}"
        def branch = sh(returnStdout: true, script:'git rev-parse --abbrev-ref HEAD').trim()
        echo "second, branch is: ${branch}"

        dumpEnv('second', vars)

        
    }

    dir('second and a half') {
        def vars = git url: 'git@github.com:jenkinsci/git-plugin.git', branch: '1.x'
        def url = sh(returnStdout: true, script: 'git config remote.origin.url').trim()
        echo "second url is: ${url}"
        def branch = sh(returnStdout: true, script:'git rev-parse --abbrev-ref HEAD').trim()
        echo "second, branch is: ${branch}"

        dumpEnv('second', vars)

        
    }


    dir('third') {
        def vars = checkout scm
        def url = sh(returnStdout: true, script: 'git config remote.origin.url').trim()
        echo "third url is: ${url}"
        def branch = sh(returnStdout: true, script:'git rev-parse --abbrev-ref HEAD').trim()
        echo "third, branch is: ${branch}"

        dumpEnv('third', vars)
    }
}

def dumpEnv(String prefix, Map env) {
    env.each { key, value -> echo("${prefix}: '${key}' = '${value}'") }
}